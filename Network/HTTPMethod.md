# HTTP Method

## HTTP API

### API URI 설계

- 회원 목록 조회 /read-member-list
- 회원 조회 /read-member-by-id
- 회원 등록 /create-member
- 회원 수정 /update-member
- 회원 삭제 /delete-member

### 위와 같이 설계하면, 리소스를 식별하여 설계한 것이 아니다

가장 중요한 것은 **Resource식별**

### 리소스의 의미

- 회원을 수정하고 등록하는 것이 리소스가 아니다.
- 예) 미네랄을 캐라 → 미네랄이 리소스
- **회원이라는 개념 자체가 바로 리소스 이다.**
- 등록, 수정, 조회라는 개념을 전부 삭제
- 회원이라는 리소스만 식별하면 된다. → 회원 리소스를 URI에 맵핑

### 리소스 중심으로 API URI 재설계, 계층 구조

- 회원 목록 조회 /members
- 회원 조회 /members/{id} → 구분할 수 없다 다른 메소드와
- 회원 등록 /members/{id}
- 회원 수정 /members/{id}
- 회원 삭제 /members/{id}

**행위는 어떻게 구분??**

## HTTP 메서드 GET, POST

- GET: 리소스 조회
- POST: 요청 데이터 처리, 주로 등록에 사용
- PUT: 리소스를 대체, 해당 리소스가 없으면 생성
- PATCH: 리소스 부분 변경
- DELETE: 리소스 삭제

## GET

- 리소스 조회
- 서버에 전달하고 싶은 데이터는 query(쿼리 파라미터, 쿼리 스트링)를 통해서 전달
- 메시지 바디를 사용해서 데이터를 전달할 수 있지만, 지원하지 않는 곳이 많아서 권장하지 않음.

### POST

- 요청 데이터 처리
- 메시지 바디를 통해 서버로 요청 데이터 전달
- 서버는 요청 데이터 처리
    - 메시지 바디를 통해 들어온 데이터를 처리하는 모든 기능을 수행한다.
    - 예) POST/ orders/{orderId}/start-delivery (컨트롤 URI)
- 주로 전달하는 데이터로 신규 리소스 등록, 프로세스 처리에 사용

### 쓰임새

- 새 리소스 생성(등록)
- 요청 데이터 처리
    - 데이터를 생성하거나, 변경하는 것을 넘어서 프로세스를 처리해야 하는 경우
- 다른 메서드로 처리하기 애매한 경우
    - JSON으로 조회 데이터를 넘겨야 하는 데, GET메서드 사용하기 어려운 경우

## HTTP 메서드 - PUT, PATCH, DELETE

### PUT

- 리소스가 없으면 대체
- 리소스가 없으면 생성
- 기존의 리소스를 수정하지 않고 덮어써버림
- **중요! 클라이언트가 리소스를 식별**
- 클라이언트가 리소스의 위치를 알고 URI를 지정
- POST와의 차이점

### PATCH

- 리소스의 부분 데이터를 변경할 때, PUT의 리소스 완전 대체의 단점을 보완하는 메서드

### DELETE

- 리소스를 제거

## HTTP 메서드의 속성

- 안전(Safe Method)
    - 호출해도 리소스를 변경하지 않는다.
    - Q. 그래도 계속 호출해서, 로그 같은 게 쌓여서 장애가 발생한다면?
    - A. 안전은 해당 리소스만 고려한다. 그런 부분까지 고려하지 않는다.
- 멱등(Idempotent Methods)
    - f(f(x)) = f(x)
    - 한번 호출하던 두번 호출하던 100번 호출 하던 결과가 똑같다.
    - 멱등 메서드
        - GET: 몇번을 조회하던 결과는 똑같다.
        - PUT: 결과를 대체한다. 같은 요청을 여러번 해도 같은 결과가 도출 된다.
        - DELETE: 결과를 삭제한다. 여러 번해도 삭제된 결과는 같다.
        - POST: 멱등이 아니다(X) 두번 호출하면 결제가 두번 발생할 수 있다.
    - 활용
        - 자동 복구 메커니즘
        - 서버가 TIMEOUT 등으로 정상 응답을 못 주었을 때, 클라이언트가 같은 요청을 다시 해도 되는가? 판단 근거
    - 재 요청 중간에 다른 곳에서 리소스를 변경해버리면?
        - 멱등은 외부요인으로 중간에 리소스가 변경되는 것 까지는 고려하지 않는다.
- 캐시 가능(Cacheable Methods)
    - 응답 결과 리소스를 캐시해서 사용해도 되는가?
    - GET, HEAD, POST, PATCH 캐시 가능
    - 실제로는 GET, HEAD 정도만 캐시로 사용
        - POST, PATCH는 본문 내용까지 캐시 키로 고려해야 하는데, 구현이 쉽지 않음.